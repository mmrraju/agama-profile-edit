Flow org.gluu.agama.profile.edit
     Basepath ""
// Profile edit flow starting
Log "@info Profile edit flow starting..."
// Create  variable for UI feedback
uiFeedback = {}
emailObj = {}
// Iterate x times max
Repeat 6 times max
     // Retrieve user mail  from UI
     userInput = RRF "mail.ftlh" emailObj
     // create an instance of user profile update service
     userProfileUpdateService = Call org.gluu.agama.jans.UserProfileUpdate#getInstance 
     // Check user already exist or not with mail
     user | E = Call userProfileUpdateService getUserEntity userInput.mail
     // If user found
     When user.empty is not true
          // User found with e-mail
          Log "@info User found with e-mail % " mailForm.mail
          // OTP to verify user
          otp = Call userProfileUpdateService sendMail userInput.mail
          // OTP form feedback
          otpFormFeedback = {}
          // Max 3 times repeat
          Repeat 3 times max
               // OTP Form
               otpFormData = RRF "otp.ftlh" otpFormFeedback
     Otherwise
          // User not found
          emailObj.errorMessage = "User not found"
// Maximum attempt reached
Log "@info Maximum attempt reached"